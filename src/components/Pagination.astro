---
interface Props {
  currentPage: number;
  totalPages: number;
}

const { currentPage, totalPages } = Astro.props;

const pages = Array.from({ length: totalPages }, (_, i) => i + 1);

// Helper to generate URL for a specific page
function getPageUrl(page: number) {
  const url = new URL(Astro.request.url);
  const params = new URLSearchParams(url.search);
  params.set("page", page.toString());
  return `${url.pathname}?${params.toString()}`;
}

// Build page elements
const pageElements = pages.map((page) => {
  const showPage =
    page === 1 ||
    page === totalPages ||
    (page >= currentPage - 1 && page <= currentPage + 1);

  const showEllipsis = page === currentPage - 2 || page === currentPage + 2;

  return {
    page,
    showPage,
    showEllipsis,
    isActive: page === currentPage,
    url: getPageUrl(page),
  };
});
---

{
  totalPages > 1 && (
    <nav class="pagination" aria-label="Pagination">
      <div class="pagination-content">
        {/* Previous Button */}
        <a
          href={currentPage > 1 ? getPageUrl(currentPage - 1) : undefined}
          class:list={["pagination-btn", { disabled: currentPage === 1 }]}
          aria-disabled={currentPage === 1}
          tabindex={currentPage === 1 ? -1 : 0}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
          <span class="sr-only">Previous</span>
        </a>

        {/* Page Numbers */}
        <div class="page-numbers">
          {pageElements.map((item) => {
            if (item.showPage) {
              return (
                <a
                  href={item.url}
                  class:list={["page-number", { active: item.isActive }]}
                  aria-current={item.isActive ? "page" : undefined}
                >
                  {item.page}
                </a>
              );
            }
            if (item.showEllipsis) {
              return <span class="ellipsis">...</span>;
            }
            return null;
          })}
        </div>

        {/* Next Button */}
        <a
          href={
            currentPage < totalPages ? getPageUrl(currentPage + 1) : undefined
          }
          class:list={[
            "pagination-btn",
            { disabled: currentPage === totalPages },
          ]}
          aria-disabled={currentPage === totalPages}
          tabindex={currentPage === totalPages ? -1 : 0}
        >
          <span class="sr-only">Next</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 18l6-6-6-6" />
          </svg>
        </a>
      </div>
    </nav>
  )
}

<style>
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--md-sys-color-outline-variant);
  }

  .pagination-content {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .pagination-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    color: var(--md-sys-color-on-surface);
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .pagination-btn:hover:not(.disabled) {
    background-color: var(--md-sys-color-surface-variant);
    color: var(--md-sys-color-on-surface-variant);
  }

  .pagination-btn.disabled {
    opacity: 0.5;
    pointer-events: none;
    cursor: default;
  }

  .page-numbers {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .page-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--md-sys-color-on-surface);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .page-number:hover {
    background-color: var(--md-sys-color-surface-variant);
    color: var(--md-sys-color-on-surface-variant);
  }

  .page-number.active {
    background-color: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
  }

  .ellipsis {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    color: var(--md-sys-color-on-surface-variant);
  }
</style>
