---
import PageBuilder from "../components/PageBuilder.astro";
import Layout from "../layouts/Layout.astro";
import { getPage, type Page } from "../lib/db";

const { slug } = Astro.params;
const currentSlug = slug || "home"; // Default to home if root

const pageData: Page | null = await getPage(currentSlug);

// Using dummy data for now
// const pageData = {
//   title: "Welcome to Our Platform",
//   blocks: [
//     {
//       type: "HeroSection",
//       data: {
//         title: "Build Amazing Websites",
//         subtitle: "Create dynamic pages with our powerful page builder",
//       },
//     },
//     {
//       type: "FeaturesGrid",
//       data: {
//         items: [
//           "Drag & Drop Editor",
//           "Real-time Preview",
//           "Custom Components",
//           "Responsive Design",
//           "SEO Optimized",
//           "Fast Performance",
//         ],
//       },
//     },
//     {
//       type: "NewsletterSignup",
//       data: {
//         ctaText: "Join Waitlist",
//       },
//     },
//   ],
// };

const error = null;
---

<Layout title={pageData ? pageData.title : "Page Not Found"}>
  <main>
    {
      error ? (
        <div style="text-align: center; padding: 2rem;">
          <h1>404</h1>
          <p>{error}</p>
        </div>
      ) : (
        <PageBuilder blocks={pageData?.blocks || []} />
      )
    }
  </main>
</Layout>
